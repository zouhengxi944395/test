<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../css/goodsdetail.css">
    <script src="../js/jquery-1.10.1.min.js"></script>
    <script src="../js/cookie.js"></script>
</head>

<body>
    <!-- 导航 -->
    <div class="header">
        <div class="logo">
            <a href="index.html"><img src="../image/logo.png" alt=""></a>
        </div>
        <div class="navbar">
            <div class="search">
                <input type="text" value="卫衣" id="searchCon">
                <button id="searchBtn">搜索</button>
            </div>
            <div class="list">
                <span class="loginspan"><a href="login.html">登录</a></span>
                <span class="regspan"><a href="regist.html">注册</a></span>
                <a href="shoppingcar.html"><img src="../image/shopcar.png" alt=""></a>
                <a href="shoppingcar.html"><span class="countSpan"></span></a>
            </div>
        </div>
    </div>
    <div class="wrapbox"></div>

    <!-- 内容 -->
    <div class="content">
        <div class="aside">
            <div class="asidenav">
                <div class="topnav">
                    <p class="list">男士</p>
                    <div class="hide">
                        <p>T恤上衣</p>
                        <p>卫衣</p>
                        <p>外套</p>
                        <p>裤装</p>
                        <p>休闲鞋</p>
                        <p>运动鞋</p>
                        <p>包包附配饰</p>
                        <p>羽绒/棉服</p>
                    </div>
                    <p class="list">女士</p>
                    <div class="hide">
                        <p>T恤上衣</p>
                        <p>卫衣</p>
                        <p>外套</p>
                        <p>连衣裙</p>
                        <p>下装</p>
                        <p>休闲鞋</p>
                        <p>运动鞋</p>
                        <p>包包附配饰</p>
                        <p>羽绒/棉服</p>
                    </div>
                    <p class="list">儿童</p>
                    <div class="hide">
                        <p>男童-服装</p>
                        <p>男童-鞋类</p>
                        <p>男童-包包附配饰</p>
                        <p>女童-服装</p>
                        <p>女童-鞋类</p>
                        <p>女童-包包附配饰</p>
                    </div>
                    <p class="line">_______________</p>
                    <p><a href="#">FUSION</a></p>
                    <p><a href="#">ATHLETICS</a></p>
                    <p class="line">_______________</p>
                    <p id="lastp"><a href="#">积分商城</a></p>
                </div>
                <div class="footernav">
                    <p>会员积分</p>
                    <div class="hide">
                        <p><a href="#">积分抵现</a></p>
                        <p><a href="#">积分说明</a></p>
                        <p><a href="#">积分商城</a></p>
                        <p><a href="#">会员制度</a></p>
                    </div>
                    <p>购物服务</p>
                    <div class="hide">
                        <p><a href="#">购物流程</a></p>
                        <p><a href="#">支付及发票</a></p>
                        <p><a href="#">物流配送</a></p>
                        <p><a href="#">退换货服务</a></p>
                        <p><a href="#">企业团购</a></p>
                    </div>
                    <p>关于FILA</p>
                    <div class="hide">
                        <p><a href="#">百年历史</a></p>
                        <p><a href="#">查找门店</a></p>
                        <p><a href="#">工作机会</a></p>
                        <p><a href="#">使用条款</a></p>
                    </div>
                    <a href="#">热点新闻</a>
                </div>
            </div>
        </div>
        <div class="banner">
            <div class="left">
                <!-- <div class="detail1">
                    <div class="imgleft">
                        <img src="../image/goodsdetail1-1.jpg" alt="">
                    </div>
                    <div class="imgright">
                        <img src="../image/goodsdetail1-2.jpg" alt="">
                        <p>其他颜色/点击查看</p>
                        <div class="minidetail">
                            <div class="mini">
                                <img src="../image/minidetail1.jpg" alt="">
                                <p>传奇蓝</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="detail2">
                    <div class="imgleft">
                        <img src="../image/goodsdetail1-3.jpg" alt="">
                    </div>
                    <div class="imgright">
                        <img src="../image/goodsdetail1-4.jpg" alt="">
                    </div>
                </div>
                <div class="detail3">
                    <p>款号： F11M941203F系列：Cross Over；<br>
                        ·棉质面料，柔顺舒适
                    </p>
                    <a class="explain">面料说明</a>
                    <div class="show">
                        <h3>面料说明</h3>
                        <a class="close">+</a>
                        <p>面料：100%棉</p>
                    </div>
                </div>
                <div class="detail4">
                    <img src="../image/goodsdetail1-5.jpg" alt="">
                    <img src="../image/goodsdetail1-6.jpg" alt="">
                    <img src="../image/goodsdetail1-7.jpg" alt="">
                </div>
                <div class="detailsize">
                    <img src="../image/size.jpg" alt="">
                </div>
                <div class="detail5">
                    <img src="../image/goodsdetail1-8.jpg" alt="">
                    <img src="../image/goodsdetail1-9.jpg" alt="">
                    <img src="../image/goodsdetail1-10.jpg" alt="">
                    <img src="../image/goodsdetail1-11.jpg" alt="">
                </div>
                <p>页面显示的被划去价格可能是商品的吊牌价零售价或曾展示过的销售价等</p> -->
            </div>
            <div class="right">
                <!-- <p class="goodsname">男士时尚运动长袖T</p>
                <p class="saleprice">￥576.00</p>
                <p class="goodsprice">吊牌价 <span>￥640.00</span></p>
                <ul class="saleinfo">
                    <li>
                        <span class="infoheader">购物满减</span>
                        <span class="infofoot">满899减80元，满1499减150元，满2099减200元,满2499减300元</span>
                    </li>
                    <li>
                        <span class="infoheader">黑卡免邮</span>
                        <span class="infofoot">黑卡会员任意消费均免运费</span>
                    </li>
                    <li>
                        <span class="infoheader">免邮标准</span>
                        <span class="infofoot">满399元免运费</span>
                    </li>
                </ul>
                <div class="color">
                    <h4>颜色:</h4>
                    <p>传奇蓝</p>
                </div>
                <div class="size">
                    <h4>选择尺码:</h4>
                    <p>3XL</p>
                    <p>2XL</p>
                    <p>XL</p>
                    <p>L</p>
                    <p>M</p>
                    <p>S</p>
                </div>
                <div class="checkbtn">
                    <button class="buybtn">立即购买</button>
                    <button class="carbtn">加入购物车</button>
                </div> -->
            </div>
        </div>
    </div>

    <!-- 底部 -->
    <div class="footer">
        <p>购物服务</p>
        <p>关于品牌</p>
        <p>查找门店</p>
        <p class="media">
            <span>关注FILA的官方媒体:</span>
            <a href="#"><span class="pic pic1"></span></a>
            <a href="#"><span class="pic pic2"></span></a>
        </p>
        <p>售后服务电话: 400-886-7699</p>
        <p>©FILA体育 闽ICP备11020421号-8</p>
    </div>

    <!-- 服务 -->
    <div class="service">
        <img src="../image/service.png" alt="">
        <span>客 服</span>
    </div>
</body>
<script>

    // 查询是否登陆
    var phone = getCookie("phone");
    if (phone) {
        $(".loginspan").html(phone);
        $(".regspan").html("退出").click(function () {
            setCookie("phone", "", -1);
            location.href = "";
        });
    }

    var phoneacc = "admin";
    if (phone) {
        phoneacc = phone;
    }


    updateCount();


    $("#searchBtn").click(function () {
        var key = $("#searchCon").val();
        location.href = `goodslist.html?key=${key}`;
    })



    // 左侧导航展开
    $(".footernav p").click(function () {
        var display = $(this).next().css("display");
        if (display == "block") {
            $(this).next().css("display", "none");
        }
        else if (display == "none") {
            $(this).siblings(".hide").css("display", "none");
            $(this).next().css("display", "block");
        }
    })

    $(".topnav .list").click(function () {
        var display = $(this).next().css("display");
        if (display == "block") {
            $(this).next().css("display", "none");
        }
        else if (display == "none") {
            $(this).siblings(".hide").css("display", "none");
            $(this).next().css("display", "block");
        }
    })


    var search = location.search;

    if (search) {
        var id = search.split("=")[1];
        console.log(id);
        $.ajax({
            type: "get",
            url: "../php/goodsdetail.php",
            data: {
                id: id
            },
            dataType: "json",
            success: function (result) {
                console.log(result);
                createHTML(result);
            }
        })
    }




    var left = document.querySelector(".left");
    var right = document.querySelector(".right");

    function createHTML(arr) {
        if (!Array.isArray(arr)) {
            var err = new Error("Pass in an array,please");
            throw err;
        }

        var htmlleft = "";
        var htmlright = "";

        var goodId, goodName, goodPrice, goodImg;

        if (arr.length > 0) {
            arr.forEach(item => {
                var { id, goodsName, goodsPrice, goodsImg, salePrice, imgList, color } = item;
                var goodsImgList = imgList.split(",");

                goodId = id;
                goodName = goodsName;
                goodPrice = goodsPrice;
                goodImg = goodsImg;

                htmlleft += `<div class="detail1">
                    <div class="imgleft">
                        <img src="../image/${goodsImgList[0]}" alt="">
                    </div>
                    <div class="imgright">
                        <img src="../image/${goodsImgList[1]}" alt="">
                        <p>其他颜色/点击查看</p>
                        <div class="minidetail">
                            <div class="mini">
                                <img src="../image/${goodsImgList[11]}" alt="">
                                <p>传奇蓝</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="detail2">
                    <div class="imgleft">
                        <img src="../image/${goodsImgList[2]}" alt="">
                    </div>
                    <div class="imgright">
                        <img src="../image/${goodsImgList[3]}" alt="">
                    </div>
                </div>
                <div class="detail3">
                    <p>款号： F11M941203F系列：Cross Over；<br>
                        ·棉质面料，柔顺舒适
                    </p>
                    <a class="explain">面料说明</a>
                    <div class="show">
                        <h3>面料说明</h3>
                        <a class="close">+</a>
                        <p>面料：100%棉</p>
                    </div>
                </div>
                <div class="detail4">
                    <img src="../image/${goodsImgList[4]}" alt="">
                    <img src="../image/${goodsImgList[5]}" alt="">
                    <img src="../image/${goodsImgList[6]}" alt="">
                </div>
                <div class="detailsize">
                    <img src="../image/size.jpg" alt="">
                </div>
                <div class="detail5">
                    <img src="../image/${goodsImgList[7]}" alt="">
                    <img src="../image/${goodsImgList[8]}" alt="">
                    <img src="../image/${goodsImgList[9]}" alt="">
                    <img src="../image/${goodsImgList[10]}" alt="">
                </div>
                <p>页面显示的被划去价格可能是商品的吊牌价零售价或曾展示过的销售价等</p>`;



                htmlright += `<p class="goodsname">${goodsName}</p>
                <p class="saleprice">￥${goodsPrice}</p>
                <p class="goodsprice">吊牌价 <span>￥${salePrice}</span></p>
                <ul class="saleinfo">
                    <li>
                        <span class="infoheader">购物满减</span>
                        <span class="infofoot">满899减80元，满1499减150元，满2099减200元,满2499减300元</span>
                    </li>
                    <li>
                        <span class="infoheader">黑卡免邮</span>
                        <span class="infofoot">黑卡会员任意消费均免运费</span>
                    </li>
                    <li>
                        <span class="infoheader">免邮标准</span>
                        <span class="infofoot">满399元免运费</span>
                    </li>
                </ul>
                <div class="color">
                    <h4>颜色:</h4>
                    <p>${color}</p>
                </div>
                <div class="size">
                    <h4>选择尺码:</h4>
                    <p>3XL</p>
                    <p>2XL</p>
                    <p>XL</p>
                    <p>L</p>
                    <p>M</p>
                    <p>S</p>
                </div>
                <div class="checkbtn">
                    <button class="buybtn">立即购买</button>
                    <button class="carbtn">加入购物车</button>
                </div>`;

            })
            left.innerHTML = htmlleft;
            right.innerHTML = htmlright;
        }
        else {
            left.innerHTML = `<span class="noSpan">暂无数据</span>`;
            right.innerHTML = `<span class="noSpan">暂无数据</span>`;
        }


        // 面料说明点击
        $(".explain").click(function () {
            $(".show").css("display", "block");
        })

        $(".close").click(function () {
            $(".show").css("display", "none");
        })

        // 右侧尺码选择
        var goodsSize;
        var addCar = document.querySelector(".carbtn");
        var goodsCount = 1;

        addCar.onclick = function () {
            alert("请选择尺码!");
        }


        $(".size p").click(function () {
            $(this).css("font-weight", "bold");
            $(this).siblings("p").css("font-weight", "normal");
            goodsSize = $(this).html();
            console.log(goodsSize);
            addCar.onclick = function () {
                $.ajax({
                    type: "get",
                    url: "../php/addtocar.php",
                    data: {
                        phone: phoneacc,
                        goodsId: goodId,
                        goodsImg: goodImg,
                        goodsName: goodName,
                        goodsSize: goodsSize,
                        goodsCount: goodsCount,
                        goodsPrice: goodPrice
                    },
                    dataType: "json",
                    success: function (result) {
                        console.log(result);
                        updateCount();
                        alert("成功加入购物车!");
                    }
                })
            }
        })

    };



    function updateCount() {
        $.ajax({
            type: "get",
            url: "../php/searchcar.php",
            data:{
                phone:phoneacc
            },
            dataType: "json",
            success: function (res) {
                console.log(res);
                var count = 0;
                res.forEach(item => {
                    var { goodsCount } = item;
                    count += parseInt(goodsCount);
                })
                console.log(count);
                $(".countSpan").html(count);
            }
        })
    }




</script>

</html>